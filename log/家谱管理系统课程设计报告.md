# 家谱管理系统课程设计报告
## 目录
### [一、 项目开发环境](#1)
### [二、 项目地址](#2)
### [三、 数据库设计](#3)
### [四、 后端项目结构介绍](#4)
### [五、 前端项目结构介绍](#5)
### [六、 项目展示](#6)
- [6.1 登录与注册](#61-登录与注册)
- [6.2 创建家谱表并编辑个人信息功能](#62-创建家谱表并编辑个人信息功能)
- [6.3 添加成员节点构建家谱树功能](#63-添加成员节点构建家谱树功能)
- [6.4 列表展示成员信息并添加事件描述功能](#64-列表展示成员信息并添加事件描述功能)
### [七、 项目总结](#7)

## 一、 项目开发环境<a id="1"></a>
### 使用软件:
- 前端开发：Visual Studio Code
- 后端开发：Intellij IDEA 2025.1
- 接口测试：Postman
### 前端开发：
- 项目依赖：
### 后端开发：
- 开发语言：Java
- 项目依赖：mysql+lombox+mybatis-plus+jjwt
- 包管理： Maven
### 服务器：
- 数据库： MySQL Server 8.0


## 二、 项目地址<a id="2"></a>
- 项目github地址：https://github.com/deneyPatrick19/family_history_system
## 三、 数据库设计<a id="3"></a>
- user表: 用于存储用户信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 124729.png>)
```sql
CREATE TABLE `user` (
  `username` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `password` varchar(20) DEFAULT NULL,
  `id` int NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  UNIQUE KEY `user_unique` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
- member表：存储家谱表中家庭成员信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 124741.png>)
```sql
-- `system`.`member` definition
CREATE TABLE `member` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `gender` varchar(5) DEFAULT NULL,
  `birthdate` date DEFAULT NULL,
  `deathdate` date DEFAULT NULL,
  `bio` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `family_table_id` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `member_family_table_FK` (`family_table_id`),
  CONSTRAINT `member_family_table_FK` FOREIGN KEY (`family_table_id`) REFERENCES `family_table` (`id`),
  CONSTRAINT `member_check` CHECK ((`gender` in (_utf8mb4'男',_utf8mb4'女')))
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
- relationship表：存储家庭成员与其父节点的关系
![alt text](<./img/报告图片/屏幕截图 2025-06-28 124749.png>)
```sql
-- `system`.relationship definition
CREATE TABLE `relationship` (
  `member_id1` int NOT NULL,
  `member_id2` int NOT NULL,
  `relation` varchar(15) DEFAULT NULL,
  PRIMARY KEY (`member_id1`,`member_id2`),
  KEY `relationship_member_FK_1` (`member_id2`),
  CONSTRAINT `relationship_member_FK` FOREIGN KEY (`member_id1`) REFERENCES `member` (`id`),
  CONSTRAINT `relationship_member_FK_1` FOREIGN KEY (`member_id2`) REFERENCES `member` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
- family_table表：存储家谱表信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 124756.png>)
```sql
-- `system`.family_table definition

CREATE TABLE `family_table` (
  `id` int NOT NULL AUTO_INCREMENT,
  `table_name` varchar(50) DEFAULT NULL,
  `content` varchar(100) DEFAULT NULL,
  `establish_time` date DEFAULT NULL,
  `user_id` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `family_table_user_FK` (`user_id`),
  CONSTRAINT `family_table_user_FK` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
- event表：存储家庭成员的重要事件信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 124803.png>)
```sql
-- `system`.event definition

CREATE TABLE `event` (
  `member_id` int NOT NULL,
  `event_date` date DEFAULT NULL,
  `event_type` varchar(20) DEFAULT NULL,
  `event_description` varchar(100) DEFAULT NULL,
  `id` int NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  KEY `event_member_FK` (`member_id`),
  CONSTRAINT `event_member_FK` FOREIGN KEY (`member_id`) REFERENCES `member` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
## 四、 后端项目结构介绍<a id="4"></a>
- entity层: 编写项目需要使用的数据库对应的Java类 用于数据传输和token加密创建类等  
![alt text](<./img/报告图片/屏幕截图 2025-06-28 125743.png>)
```java
package com.example.family_history_system.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableName;
import com.baomidou.mybatisplus.annotation.TableId;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
@TableName(value = "user")
public class User {
    @ApiModelProperty("用户id")
    @TableId(value = "id",type = IdType.AUTO)
    private Integer id;
    private String username;
    private String password;
}
```
```java
package com.example.family_history_system.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.util.Date;

@Data
@TableName(value = "member")
public class Member {
    @TableId(value = "id",type = IdType.AUTO)
    private Integer id;
    private Integer family_table_id;
    private String name;
    private String gender;
    private Date birthdate;
    private Date deathdate;
    private String bio;
}
```
```java
package com.example.family_history_system.entity;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import com.github.jeffreyning.mybatisplus.anno.MppMultiId;

import lombok.Data;

@Data
@TableName(value = "relationship")
public class Relationship {
    @MppMultiId
    @TableField("member_id1")
    private Integer member_id1;
    @MppMultiId
    @TableField("member_id2")
    private Integer member_id2;
    private String relation;
}
```
```java
package com.example.family_history_system.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.util.Date;

@Data
@TableName("family_table")
public class Family_table {
    @TableId(value = "id",type = IdType.AUTO)
    private Integer id;
    private Integer user_id;
    private String table_name;
    private String content;
    private Date establish_time;
}
```
```java
package com.example.family_history_system.entity;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;
import java.util.Date;

@Data
@TableName(value = "event")
public class Event {
    @TableId(value = "id",type = IdType.AUTO)
    private Integer id;
    private Integer member_id;
    private Date event_date;
    private String event_type;
    private String event_description;
}
```
```java
package com.example.family_history_system.entity;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;

import java.util.Date;

public class JwtUtil {
    private static final String SECRET_KEY = "family_history_system_secret_key_2024";
    private static final long EXPIRATION_TIME = 86400000; // 24小时，单位毫秒

    public static String generateToken(String username) {
        Date now = new Date();
        Date expiration = new Date(now.getTime() + EXPIRATION_TIME);
        
        return Jwts.builder()
                .setSubject(username)
                .setIssuedAt(now)
                .setExpiration(expiration)
                .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
                .compact();
    }

    public static String getUsernameFromToken(String token) {
        Claims claims = Jwts.parser()
                .setSigningKey(SECRET_KEY)
                .parseClaimsJws(token)
                .getBody();
        
        return claims.getSubject();
    }

    public static boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }

    public static boolean isTokenExpired(String token) {
        try {
            Claims claims = Jwts.parser()
                    .setSigningKey(SECRET_KEY)
                    .parseClaimsJws(token)
                    .getBody();
            
            return claims.getExpiration().before(new Date());
        } catch (Exception e) {
            return true;
        }
    }
} 
```
```java
package com.example.family_history_system.entity;
import lombok.Data;
import java.util.Map;

@Data
public class Response {
    private String status;
    private String msg;
    private Map<String, Object> data;

    public static Response buildSuccess(Map<String, Object> data){
        Response responseBody = new Response();
        responseBody.setStatus("200");
        responseBody.setMsg("success");
        responseBody.setData(data);
        return responseBody;
    }
    
    public static Response buildFault(){
        Response responseBody = new Response();
        responseBody.setStatus("400");
        responseBody.setMsg("failure");
        return responseBody;
    }
}
```
- mapper层：将数据库操作映射为sql语句 并返回相应的sql语句结果
![alt text](<./img/报告图片/屏幕截图 2025-06-28 125759.png>)  
示例：
```java
package com.example.family_history_system.mapper;
import com.example.family_history_system.entity.User;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.*;
import org.apache.ibatis.type.JdbcType;
import java.util.List;

@Mapper
public interface UserMapper extends BaseMapper<User> {

    @Select("select * from `system`.user ")
    @Results({
            @Result(property = "id", column = "id", jdbcType = JdbcType.INTEGER, id = true),
            @Result(property = "username", column = "username", jdbcType = JdbcType.VARCHAR),
            @Result(property = "password", column = "password", jdbcType = JdbcType.VARCHAR),
    })
    List<User> findAll();

    @Select("select * from `system`.user where username = #{username}")
    @Results({
            @Result(property = "id", column = "id", jdbcType = JdbcType.INTEGER, id = true),
            @Result(property = "username", column = "username", jdbcType = JdbcType.VARCHAR),
            @Result(property = "password", column = "password", jdbcType = JdbcType.VARCHAR),
    })
    User findByUsername(@Param("username") String username);
}
```
- service和serviceImpl层：业务逻辑的接口以及实现的地方
![alt text](<./img/报告图片/屏幕截图 2025-06-28 125805.png>)  
示例：
```java
package com.example.family_history_system.service.impl;

import com.example.family_history_system.entity.User;
import com.example.family_history_system.mapper.UserMapper;
import com.example.family_history_system.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserMapper userMapper;

    public int insert(User user){
        return userMapper.insert(user);
    }
    public int update(User user){
        return userMapper.updateById(user);
    }
    public int delete(Integer id){
        return userMapper.deleteById(id);
    }
    public User findById(Integer id){
        return userMapper.selectById(id);
    }
    public List<User> findAll(){
        return  userMapper.findAll();
    }
    public Boolean verifyUser(String username, String password){
        User User2 = userMapper.findByUsername(username);
        if (User2 == null) {
            return false;
        }else {
            return password.equals(User2.getPassword());
        }
    }
    public User findByUsername(String username){
        return userMapper.findByUsername(username);
    }
}
```
- controller层:接收前端发送请求并返回数据 其中有构建家谱树、分析家谱关系等核心功能  
![alt text](<./img/报告图片/屏幕截图 2025-06-28 125753.png>)  
示例：
```java
package com.example.family_history_system.controller;
import com.example.family_history_system.entity.Response;
import com.example.family_history_system.entity.JwtUtil;
import com.example.family_history_system.service.UserService;
import org.apache.ibatis.annotations.Param;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import com.example.family_history_system.entity.User;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@CrossOrigin
@RestController
@ResponseBody
@RequestMapping("/user")
public class UserController {
    @Autowired
    private UserService userService;

    @PostMapping("/signup")
    public int signup(@RequestBody User user){
        if (userService.findByUsername(user.getUsername())==null){
            return userService.insert(user);
        }
        return 0;
    }

    @PostMapping("/update")
    public int update(@RequestBody User user){
        return userService.update(user);
    }

    @PostMapping("/delete")
    public int delete(@RequestParam Integer id){
        return userService.delete(id);
    }

    @PostMapping("/find")
    public User find(@RequestParam Integer id){
        return userService.findById(id);
    }

    @GetMapping("/findall")
    public List<User> findAll(){
        return userService.findAll();
    }

    @PostMapping("/login")
    public Response login(@Param("username") String username, @Param("password")  String password) {
        Boolean result =  userService.verifyUser(username, password);
        if (result){
            // 生成JWT token
            String token = JwtUtil.generateToken(username);
            
            // 创建返回数据，包含token和用户信息
            Map<String, Object> data = new HashMap<>();
            data.put("token", token);
            data.put("username", username);
            
            return Response.buildSuccess(data);
        }
        return Response.buildFault();
    }
}
```
## 五、 前端项目结构介绍<a id="5"></a>
- components：家谱表的节点样式和节点选项样式
![alt text](<./img/报告图片/屏幕截图 2025-06-28 131227.png>)
```html
<template>
  <div class="tree-node">
    <div class="node-content" :class="{ 'selected': selectedNode === node }" @click="selectNode(node)">
      <div class="node-avatar">
        <el-avatar :size="30" :src="node.avatar">{{ node.name.charAt(0) }}</el-avatar>
      </div>
      <div class="node-info">
        <div class="node-name">{{ node.name }}</div>
        <div class="node-details">{{ formatDate(node.birthDate) }} | {{ node.gender }}</div>
        <div v-if="node.deathDate" class="node-death">死亡: {{ formatDate(node.deathDate) }}</div>
        <div v-if="node.parentName" class="node-parent">父节点: {{ node.parentName }}</div>
        <div v-if="node.bio" class="node-bio">{{ node.bio }}</div>
      </div>
      <div class="node-actions">
        <el-button size="small" type="primary" @click.stop="addChild(node)">添加子节点</el-button>
        <el-button 
          size="small" 
          type="info" 
          @click.stop="async () => await addParent(node)"
          :disabled="node.parentId"
          :title="node.parentId ? '该节点已有父节点' : '添加父节点'"
        >添加父节点</el-button>
        <el-button size="small" type="warning" @click.stop="viewNode(node)">查看</el-button>
        <el-button size="small" type="danger" @click.stop="deleteNode(node)">删除</el-button>
      </div>
    </div>
    <div class="children-container" v-if="node.children && node.children.length > 0">
      <div class="children-wrapper">
        <FamilyNode
          v-for="child in node.children"
          :key="child.id"
          :node="child"
          :selectedNode="selectedNode"
          :selectNode="selectNode"
          :addChild="addChild"
          :addParent="addParent"
          :viewNode="viewNode"
          :deleteNode="deleteNode"
          :formatDate="formatDate"
        />
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'FamilyNode',
  props: [
    'node', 'selectedNode', 'selectNode',
    'addChild', 'addParent', 'viewNode', 'deleteNode', 'formatDate'
  ]
}
</script>

<style scoped>
.tree-node {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.node-content {
  display: flex;
  align-items: center;
  background: white;
  border: 2px solid #e4e7ed;
  border-radius: 8px;
  padding: 15px;
  margin: 10px;
  min-width: 300px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.node-content.selected {
  border-color: #409eff;
  background: #f0f9ff;
}
.node-avatar {
  margin-right: 15px;
}
.node-info {
  flex: 1;
  min-width: 0;
}
.node-name {
  font-weight: bold;
  font-size: 16px;
  color: #303133;
  margin-bottom: 5px;
}
.node-details {
  font-size: 12px;
  color: #909399;
}
.node-death {
  font-size: 11px;
  color: #f56c6c;
  margin-top: 2px;
}
.node-parent {
  font-size: 11px;
  color: #67c23a;
  margin-top: 2px;
}
.node-bio {
  font-size: 12px;
  color: #909399;
  margin-top: 5px;
}
.node-actions {
  display: flex;
  gap: 5px;
  margin-left: 15px;
}
.children-container {
  position: relative;
  margin-top: 20px;
}
.children-wrapper {
  display: flex;
  gap: 40px;
  position: relative;
}
</style> 
```
- store:利用vuex保存用户信息和后端发送的token
![alt text](<./img/报告图片/屏幕截图 2025-06-28 131238.png>)
```js
import { createStore } from 'vuex'

export default createStore({
  state: {
    // 存储用户信息
    user: {
      id: null,
      username: '',
      token: ''
    },
    // 存储家族成员信息
    members: [],
    // 存储选中的家族表ID（持久化）
    selectedFamilyTableId: localStorage.getItem('selectedFamilyTableId') || null
  },
  
  mutations: {
    // 设置用户信息
    SET_USER(state, user) {
      state.user = user
    },
    
    // 清除用户信息
    CLEAR_USER(state) {
      state.user = { id: null, username: '', token: '' }
    },
    
    // 添加家族成员
    ADD_MEMBER(state, member) {
      state.members.push(member)
    },
    
    // 设置家族成员列表
    SET_MEMBERS(state, members) {
      state.members = members
    },
    
    // 设置选中的家族表ID
    SET_SELECTED_FAMILY_TABLE_ID(state, familyTableId) {
      state.selectedFamilyTableId = familyTableId
      localStorage.setItem('selectedFamilyTableId', familyTableId)
    }
  },
  
  actions: {
    // 登录动作
    login({ commit }, userInfo) {
      commit('SET_USER', userInfo)
      // 同时保存到 localStorage
      localStorage.setItem('token', userInfo.token)
      localStorage.setItem('username', userInfo.username)
      if (userInfo.id) {
        localStorage.setItem('userId', userInfo.id)
      }
    },
    
    // 退出登录
    logout({ commit }) {
      commit('CLEAR_USER')
      commit('SET_SELECTED_FAMILY_TABLE_ID', null)
      localStorage.removeItem('token')
      localStorage.removeItem('username')
      localStorage.removeItem('userId')
      localStorage.removeItem('selectedFamilyTableId')
    },
    
    // 初始化用户信息（从 localStorage 读取）
    initUser({ commit }) {
      const token = localStorage.getItem('token')
      const username = localStorage.getItem('username')
      const userId = localStorage.getItem('userId')
      if (token && username) {
        commit('SET_USER', { 
          token, 
          username, 
          id: userId ? parseInt(userId) : null 
        })
      }
    },
    
    // 设置选中的家族表ID
    setSelectedFamilyTableId({ commit }, familyTableId) {
      commit('SET_SELECTED_FAMILY_TABLE_ID', familyTableId)
    }
  },
  
  getters: {
    // 获取用户信息
    user: state => state.user,
    
    // 判断是否已登录
    isLoggedIn: state => !!state.user.token,
    
    // 获取家族成员
    members: state => state.members,
    
    // 获取选中的家族表ID
    selectedFamilyTableId: state => state.selectedFamilyTableId
  }
})
```
- api:编写前端向后端发送的axios请求  
![alt text](<./img/报告图片/屏幕截图 2025-06-28 131222.png>)
```js
import api from './familyTree'

// 家族表相关API
export const familyTableAPI = {
  // 获取用户的所有家族表
  getUserFamilyTables(userId) {
    return api.get(`/family-table/user/${userId}`)
  },

  // 创建新的家族表
  createFamilyTable(tableData) {
    return api.post('/family-table/create', tableData)
  },

  // 获取所有家族表
  getAllFamilyTables() {
    return api.get('/family-table/findall')
  },

  // 根据ID获取家族表
  getFamilyTableById(id) {
    return api.post('/family-table/find', { id })
  },

  // 更新家族表
  updateFamilyTable(tableData) {
    return api.post('/family-table/update-family-table', tableData)
  },

  // 删除家族表
  deleteFamilyTable(id) {
    return api.post('/family-table/delete-family-table', { id })
  }
} 
```
```js
import api from './familyTree'

// 事件相关API
export const eventAPI = {
  // 获取指定成员的所有事件
  getMemberEvents(memberId) {
    return api.get(`/event/member/${memberId}`)
  },

  // 添加事件
  addEvent(eventData) {
    return api.post('/event/insert', eventData)
  },

  // 更新事件
  updateEvent(eventData) {
    return api.post('/event/update', eventData)
  },

  // 删除事件
  deleteEvent(id) {
    return api.post('/event/delete', null, { params: { id } })
  },

  // 根据ID获取事件
  getEventById(id) {
    return api.post('/event/find', null, { params: { id } })
  },

  // 获取所有事件
  getAllEvents() {
    return api.get('/event/findall')
  }
} 
```
```js
import axios from 'axios'

// 创建axios实例
const api = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
api.interceptors.request.use(
  config => {
    // 可以在这里添加token等认证信息
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器
api.interceptors.response.use(
  response => {
    return response
  },
  error => {
    return Promise.reject(error)
  }
)

// 家谱树相关API
export const familyTreeAPI = {
  // 获取家谱树数据
  getFamilyTree(familyTableId) {
    return api.get(`/family-tree/${familyTableId}`)
  },

  // 获取所有成员列表
  getAllMembers(familyTableId) {
    return api.get(`/family-tree/members/${familyTableId}`)
  },

  // 保存节点
  saveNode(nodeData) {
    return api.post('/family-tree/save-node', nodeData)
  },

  // 更新节点
  updateNode(nodeData) {
    return api.post('/family-tree/update-node', nodeData)
  },

  // 删除节点
  deleteNode(nodeData) {
    return api.post('/family-tree/delete-node', nodeData)
  },

  // 检查节点是否已经有父节点
  checkParent(memberId) {
    return api.get(`/family-tree/check-parent/${memberId}`)
  }
}
export default api 
```
- router:存放路由和所有的界面路径  
![alt text](<./img/报告图片/屏幕截图 2025-06-28 131235.png>)
```js
import { createRouter, createWebHistory } from 'vue-router'
const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/', redirect: '/login'
    },
    {
      path: '/login', name: 'login', 
      component: () => import('../views/Login.vue')
    },
    {
      path: '/home', name: 'home', 
      component: () => import('../views/Home.vue'),
      children:[
      {
        path: '', name: 'welcome',
        component: () => import('../views/Welcome.vue')
      },
      {
        path: '/personal-history', name: 'personalhistory',
        component: () => import('../views/PersonalHistory.vue')
      },
      {
        path: '/family-tree', name: 'familytree',
        component: () => import('../views/Familytree.vue')
      },
      {
        path: '/member-list', name: 'memberlist',
        component: () => import('../views/MemberList.vue')
      },
      {
        path: '/family-table-manager', name: 'familytablemanager',
        component: () => import('../views/FamilyTableManager.vue')
      },
    ]
    },
    {
      path: '/signup', name: 'sign',
      component: () => import('../views/Sign.vue')
    }
  ]
})
export default router
``
- main.js:用于存放插件和依赖的配置
![alt text](<./img/报告图片/屏幕截图 2025-06-28 131250.png>)
```js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import zhCn from 'element-plus/es/locale/lang/zh-cn'
import store from './store/store'
const app = createApp(App)

app.use(router)
app.use(ElementPlus,
    {locale: zhCn,}
)
app.use(store)
app.mount('#app')
```
## 六、 项目展示<a id="6"></a>
### 6.1 登录与注册
- 登录界面：所有用户都使用统一登录界面进行登录  
![alt text](<./img/报告图片/屏幕截图 2025-06-28 135434.png>)
- 用户输入账号密码后 并点击登录按钮 前端会发送验证请求 后端检验数据库中的用户密码是否存在或正确 若用户不存在或密码错误 会提醒用户进行注册或重新输入
![alt text](<./img/报告图片/屏幕截图 2025-06-28 135713.png>)
- 点击登录按钮右侧链接可跳转到注册界面 进行账户的注册 界面与登录界面一致 同样的 注册按钮右侧链接可以返回登录界面
![alt text](<./img/报告图片/屏幕截图 2025-06-28 140016.png>)
- 主界面：可以在这里选择跳转到所有功能实现界面 创建家谱、编辑个人信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 140406.png>)
- 左侧侧边栏显示了管理系统的所有功能 用户可以点击文字进行页面的跳转
- 登录页面的实现：
```html
<template>
  <div id="background">
    <h1>家庭族谱管理系统</h1>
    <div id="login">
      <el-card>
        <div class="card-header" style="font-size: 20px; font-weight: bold; text-align: center;">
          <span>登录</span>
        </div>
        <div id="form">
          <el-text style="color: black; padding-right: 15px; padding-left: 15px;">账号: </el-text> 
          <el-input v-model="username" style="width: 210px" placeholder="请输入账号" />
          <el-text style="color: black; padding-right: 15px;padding-left: 15px;">密码: </el-text>
          <el-input v-model="password" style="width: 210px" placeholder="请输入密码" show-password/>
          <div>
            <el-button type="primary" @click="signup">登录</el-button>
            <a type="primary" style="font-size: 12px;" href="http://localhost:5173/signup">没有账号？点击注册</a>
          </div>
        </div>
      </el-card>
    </div>
  </div>
</template>

<script>
import axios from 'axios';
export default{
  data(){
    return {
      "username":"",
      "password":"",
    }
  },
  
  methods:{
  signup:function(e){
    var param = new URLSearchParams();
    param.append("username", this.username)
    param.append("password", this.password)
    axios.post("http://localhost:8080/user/login", param , {headers:{
      'Content-Type': 'application/x-www-form-urlencoded'
      }
    }
    ).then(response => {
      if (response.data.data && response.data.data.token != null) {
        // 使用 store 存储用户信息
        this.$store.dispatch('login', {
          username: response.data.data.username || this.username,
          token: response.data.data.token,
          id: response.data.data.id
        });
        this.$router.push("/home");
      } else {
        this.$message.error("登录失败！您的账号或密码不正确，若没有账号请先注册");
      }
    }).catch(() => {
      this.$message.error("登录失败！请检查网络连接");
    })
  },
  }
}
</script>


<style scoped>
h1{
  font-size: 50px;
  text-align: center;
}
#background{
  position:fixed;
  height: 100%;
  width:100%;
  top:0;
  left:0;
  background-image: linear-gradient(
    90deg,
    cyan,
    gray
    /* rgb(247, 246, 246) */
  );
}
#login{
  position:absolute;
  top:35%;
  left:38%;
}
.el-card{
  background-color:rgba(255, 2555, 255, 0.4);
  width: 369px;
  height: 200px;
}
#form{
  line-height: 45px;
  padding-left: 15px;
  padding-right: 15px;
}
.el-button{
  position:relative;
  left:25%;
}
a{
  position: absolute;
  left: 60%;
}

</style>
```
```html
<template>
  <div id="background">
    <h1>家庭族谱管理系统</h1>
    <div id="login">
      <el-card>
        <div class="card-header" style="font-size: 20px; font-weight: bold; text-align: center;">
          <span>登录</span>
        </div>
        <div id="form">
          <el-text style="color: black; padding-right: 15px; padding-left: 15px;">账号: </el-text> 
          <el-input v-model="username" style="width: 210px" placeholder="请输入账号" />
          <el-text style="color: black; padding-right: 15px;padding-left: 15px;">密码: </el-text>
          <el-input v-model="password" style="width: 210px" placeholder="请输入密码" show-password/>
          <div>
            <el-button type="primary" @click="signup">登录</el-button>
            <a type="primary" style="font-size: 12px;" href="http://localhost:5173/signup">没有账号？点击注册</a>
          </div>
        </div>
      </el-card>
    </div>
  </div>
</template>

<script>
import axios from 'axios';
export default{
  data(){
    return {
      "username":"",
      "password":"",
    }
  },
  
  methods:{
  signup:function(e){
    var param = new URLSearchParams();
    param.append("username", this.username)
    param.append("password", this.password)
    axios.post("http://localhost:8080/user/login", param , {headers:{
      'Content-Type': 'application/x-www-form-urlencoded'
      }
    }
    ).then(response => {
      if (response.data.data && response.data.data.token != null) {
        // 使用 store 存储用户信息
        this.$store.dispatch('login', {
          username: response.data.data.username || this.username,
          token: response.data.data.token,
          id: response.data.data.id
        });
        this.$router.push("/home");
      } else {
        this.$message.error("登录失败！您的账号或密码不正确，若没有账号请先注册");
      }
    }).catch(() => {
      this.$message.error("登录失败！请检查网络连接");
    })
  },
  }
}
</script>


<style scoped>
h1{
  font-size: 50px;
  text-align: center;
}
#background{
  position:fixed;
  height: 100%;
  width:100%;
  top:0;
  left:0;
  background-image: linear-gradient(
    90deg,
    cyan,
    gray
    /* rgb(247, 246, 246) */
  );
}
#login{
  position:absolute;
  top:35%;
  left:38%;
}
.el-card{
  background-color:rgba(255, 2555, 255, 0.4);
  width: 369px;
  height: 200px;
}
#form{
  line-height: 45px;
  padding-left: 15px;
  padding-right: 15px;
}
.el-button{
  position:relative;
  left:25%;
}
a{
  position: absolute;
  left: 60%;
}

</style>
```
```html
<template>
  <div class="home">
    <el-container style="width: 100%;">
      <el-header id="header">
        <div class="header-content">
          <h1 class="header-title">家庭族谱管理系统</h1>
          <div class="header-user">
            <span class="username">{{ username }}</span>
            <el-button type="text" @click="logout" style="color: #000;">退出登录</el-button>
          </div>
        </div>
      </el-header>
      <el-container style="width: 100%;">
        <el-aside id="sidebar">
          <el-menu :router="true" :default-active="$route.path">
            <el-menu-item v-for="(item, index) in menuItems" :key="index" :index="item.path">
              {{ item.id }}
            </el-menu-item>
          </el-menu>
        </el-aside>
        <el-main id="main_content">
          <div class="main-bg">
            <router-view></router-view>
          </div>
        </el-main>
      </el-container>
    </el-container>
  </div>
</template>

<script>
export default {
  name: "Home",
  data() {
    return {
      menuItems: [
        { id: "首页", path: "/home" },
        { id: "个人信息", path: "/personal-history" },
        { id: "家谱表管理", path: "/family-table-manager" },
        { id: "成员列表", path: "/member-list" }
      ]
    }
  },
  computed: {
    username() {
      return this.$store.getters.user.username
    }
  },
  methods: {
    logout() {
      // 使用 store 退出登录
      this.$store.dispatch('logout');
      this.$router.push('/login');
    }
  },
  mounted() {
    // 页面加载时初始化用户信息
    this.$store.dispatch('initUser');
  }
}
</script>


<style scoped>
.el-container{
  height: 100%;
}
.main-bg {
  height: 98%;
  background: #fff;
  border-radius: 5px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  padding: 4px 24px;
  margin: 2px;
  width: 100vw;
  height: 100vh;
  overflow-x: auto;
  overflow-y: auto;
}
.home {
  display: flex;
  flex-direction: column;
  background-size: 100% 100%;
  background-attachment: fixed;
  width: 100%;
  height: 100%;
  justify-content: center;
  align-items: center;
}
.router-link-active {
  text-decoration: none;
}
#header{
  background-color: #42ade7;
  height: 66px;
  padding: 0px;
  margin: 0px;
}
#sidebar{
  width: 140px;
  background-color: rgb(255, 255, 255);
  text-align: left;
}
#main_content{
  background-color: rgb(242, 239, 239);
  /* border-radius: 8px; */
}
.active {
  background-color: #3498db;
  color: white;
}
.el-menu-item{
  font-size: 16px;
}
.header-content {
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  padding: 0 24px; /* 可选：让内容不贴边 */
}
.header-title {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  margin: 0;
  color: #fff;
  white-space: nowrap;
}
.header-user {
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 1;
}
.username {
  font-weight: bold;
  color: #fff;
}
</style>

```
### 6.2 创建家谱表并编辑个人信息功能
- 进入个人信息界面 用户可以编辑自己的个人信息 包括姓名、生日和生平简介等 并利用store保存在前端页面中 即使推出浏览器后重新进入也依然存在
![alt text](<./img/报告图片/屏幕截图 2025-06-28 140817.png>)
- 用户想要编辑信息需要点击编辑履历按钮并选择确定 才能填写信息 之后也必须提交才能保存信息 避免用户误触等行为 这些步骤都有提示信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 140956.png>) 
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141004.png>)
- 用户点击家谱表管理 可以进入家谱表管理界面 这里可以显示所有家谱表信息并且用户可以选择新建、编辑或删除家谱表 同时用户也可以从这里进入具体的家谱表中添加家庭成员节点 构建家谱树
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141230.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141254.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141333.png>)
- 实现代码：
```html
<template>
  <div>
    <div class="member-history">
      <h1>个人信息</h1>
        <el-form :model="member" label-width="80px">
          <el-form-item label="姓名">
            <el-input v-model="member.name" :disabled="readonly" placeholder="请输入姓名" />
          </el-form-item>
          <el-form-item label="出生日期" prop="dob">
            <el-date-picker 
              v-model="member.dob" 
              type="date" 
              :disabled="readonly" 
              placeholder="选择出生日期" 
              format="YYYY-MM-DD"
              value-format="YYYY-MM-DD"
              style="width: 100%;" 
            />
          </el-form-item>
          <el-form-item label="性别">
            <el-select v-model="member.gender" :disabled="readonly" placeholder="请选择性别" style="width: 100%;">
              <el-option label="男" value="男" />
              <el-option label="女" value="女" />
            </el-select>
          </el-form-item>
          <el-form-item label="死亡日期">
            <el-date-picker v-model="member.deathDate" type="date" :disabled="readonly" placeholder="选择死亡日期" style="width: 100%;" />
          </el-form-item>
          <el-form-item label="生平简介">
            <el-input v-model="member.bio" :disabled="readonly" placeholder="请输入生平简介" />
          </el-form-item>
          <el-form-item>
            <el-button v-if="readonly" type="primary" @click="edit">编辑履历</el-button>
            <el-button v-else type="success" @click="submit">提交履历</el-button>
          </el-form-item>
        </el-form>
    </div>
  </div>
</template>

<script>
import { ElMessageBox, ElMessage } from 'element-plus';
export default {
  data() {
    return {
      member: {
        name: '',
        dob: '',
        gender: '男',
        deathDate: '',
        bio: '',
      },
      readonly: true,
    };
  },
  methods: {
    saveUserInfo() {
      // 使用 store 保存个人信息
      this.$store.commit('SET_MEMBERS', [this.member]);
      // 同时保存到 localStorage 作为备份
      localStorage.setItem('member', JSON.stringify(this.member));
    },
    loadUserInfo() {
      // 优先从 store 读取，如果没有则从 localStorage 读取
      const storeMembers = this.$store.getters.members;
      if (storeMembers.length > 0) {
        this.member = storeMembers[0];
      } else {
        const saved = localStorage.getItem('member');
        if (saved) {
          this.member = JSON.parse(saved);
        }
      }
    },
    edit() {
      ElMessageBox.confirm('您确定进行编辑吗？是否继续', '警告', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        ElMessage({
          type: 'success',
          message: '已确认'
        });
        this.readonly = false;
      }).catch((err) => {
        ElMessage({
          type: 'info',
          message: '取消操作' + err,
        });
      });
    },
    submit() {
      ElMessageBox.confirm('您确定进行提交吗？是否继续', '警告', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        ElMessage({
          type: 'success',
          message: '已提交'
        });
        this.saveUserInfo();
        this.readonly = true;
      }).catch((err) => {
        ElMessage({
          type: 'info',
          message: '取消操作' + err,
        });
      });
    }
  },
  mounted() {
    this.loadUserInfo();
  }
};
</script>

<style scoped>
.member-history {
  max-width: 500px;
  margin-left: 30%;
  text-align: center;
}
label {
  display: block;
  margin-top: 10px;
}
.el-card {
  margin: 8px;
  padding: 8px;
  text-align: left;
}
input, select {
  width: 400px;
  padding: 8px;
  margin: 8px 0;
}
button, .el-button {
  width: 60%;
  padding: 10px;
  background-color: #4CAF50;
  color: white;
  border: none;
  margin-top: 20px;
  cursor: pointer;
}
.main-bg {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  padding: 32px 24px;
  min-height: 400px; /* 可根据需要调整 */
  margin: 32px auto;
  max-width: 900px;  /* 可根据需要调整 */
}
</style> 
```
```html
<template>
  <div class="family-table-manager">
    <div class="header">
      <h2>家谱表管理</h2>
      <el-button type="primary" @click="showCreateDialog = true">新建家谱表</el-button>
    </div>
    <el-table :data="tableList" style="width: 100%; margin-top: 20px;">
      <el-table-column prop="name" label="家谱表名称" align="center" />
      <el-table-column prop="content" label="简介" align="center" />
      <el-table-column prop="createTime" label="创建时间" align="center" />
      <el-table-column label="操作" align="center" width="260">
        <template #default="scope">
          <el-button type="success" size="small" @click="enterTable(scope.row)">进入</el-button>
          <el-button type="primary" size="small" @click="showEdit(scope.row)">编辑</el-button>
          <el-button type="danger" size="small" @click="deleteTable(scope.row)" :loading="deletingId === scope.row.id">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
    <!-- 新建家谱表对话框 -->
    <el-dialog v-model="showCreateDialog" title="新建家谱表" width="400px">
      <el-form :model="createForm" :rules="createRules" ref="createFormRef" label-width="80px">
        <el-form-item label="名称" prop="name">
          <el-input v-model="createForm.name" placeholder="请输入家谱表名称" />
        </el-form-item>
        <el-form-item label="简介" prop="content">
          <el-input v-model="createForm.content" placeholder="请输入家谱表简介" type="textarea" />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showCreateDialog = false">取消</el-button>
        <el-button type="primary" @click="handleCreate">确定</el-button>
      </template>
    </el-dialog>
    <!-- 编辑家谱表对话框 -->
    <el-dialog v-model="showEditDialog" title="编辑家谱表" width="400px">
      <el-form :model="editForm" :rules="createRules" ref="editFormRef" label-width="80px">
        <el-form-item label="名称" prop="name">
          <el-input v-model="editForm.name" placeholder="请输入家谱表名称" />
        </el-form-item>
        <el-form-item label="简介" prop="content">
          <el-input v-model="editForm.content" placeholder="请输入家谱表简介" type="textarea" />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showEditDialog = false">取消</el-button>
        <el-button type="primary" @click="handleEdit">保存</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { ElMessage, ElMessageBox } from 'element-plus'
import { familyTableAPI } from '../api/familyTable'

export default {
  name: 'FamilyTableManager',
  data() {
    return {
      tableList: [],
      showCreateDialog: false,
      showEditDialog: false,
      createForm: { name: '', content: '' },
      editForm: { id: '', name: '', content: '' },
      createRules: {
        name: [{ required: true, message: '请输入名称', trigger: 'blur' }],
        content: [{ required: true, message: '请输入简介', trigger: 'blur' }]
      },
      createFormRef: null,
      editFormRef: null,
      deletingId: null
    }
  },
  mounted() {
    this.loadTableList()
  },
  methods: {
    async loadTableList() {
      try {
        const userId = this.$store.getters.user.id || 1
        const res = await familyTableAPI.getUserFamilyTables(userId)
        if (res.data.success) {
          this.tableList = res.data.data.map(item => ({
            ...item,
            name: item.tableName || item.table_name || item.name,
            content: item.content,
            createTime: (item.createTime || item.establish_time)
              ? (item.createTime || item.establish_time).toString().slice(0, 10)
              : ''
          }))
        } else {
          ElMessage.error(res.data.message || '获取家谱表列表失败')
        }
      } catch (e) {
        ElMessage.error('获取家谱表列表失败')
      }
    },
    enterTable(row) {
      this.$store.dispatch('setSelectedFamilyTableId', row.id)
      this.$router.push('/family-tree')
    },
    showEdit(row) {
      this.editForm = { id: row.id, name: row.name, content: row.content }
      this.showEditDialog = true
    },
    async handleEdit() {
      this.$refs.editFormRef.validate(async valid => {
        if (!valid) return
        try {
          const res = await familyTableAPI.updateFamilyTable({
            id: this.editForm.id,
            tableName: this.editForm.name,
            content: this.editForm.content
          })
          if (res.data.success) {
            ElMessage.success('编辑成功')
            this.showEditDialog = false
            this.loadTableList()
          } else {
            ElMessage.error(res.data.message || '编辑失败')
          }
        } catch (e) {
          ElMessage.error('编辑失败')
        }
      })
    },
    deleteTable(row) {
      ElMessageBox.confirm(`确定要删除家谱表"${row.name}"吗？此操作不可恢复！`, '提示', {
        type: 'warning',
        confirmButtonText: '删除',
        cancelButtonText: '取消'
      }).then(async () => {
        this.deletingId = row.id
        try {
          const res = await familyTableAPI.deleteFamilyTable(row.id)
          if (res.data.success) {
            ElMessage.success('删除成功')
            this.loadTableList()
          } else {
            ElMessage.error(res.data.message || '删除失败')
          }
        } catch (e) {
          ElMessage.error('删除失败')
        } finally {
          this.deletingId = null
        }
      }).catch(() => {})
    },
    handleCreate() {
      this.$refs.createFormRef.validate(async valid => {
        if (!valid) return
        try {
          const userId = this.$store.getters.user.id || 1
          const res = await familyTableAPI.createFamilyTable({
            tableName: this.createForm.name,
            content: this.createForm.content,
            userId
          })
          if (res.data.success) {
            ElMessage.success('新建成功')
            this.showCreateDialog = false
            this.createForm.name = ''
            this.createForm.content = ''
            this.loadTableList()
          } else {
            ElMessage.error(res.data.message || '新建失败')
          }
        } catch (e) {
          ElMessage.error('新建失败')
        }
      })
    }
  }
}
</script>

<style scoped>
.family-table-manager {
  padding: 32px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  min-height: 80vh;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
</style> 
```
### 6.3 添加成员节点构建家谱树功能
- 当用户选择进入一个指定的家谱表后 用户可以选择创建根节点开始构建家谱树 即家谱树的第一个节点 
- 也可以选择增加个人节点 使用个人信息页面中保存的信息 将其放在一个已经存在的节点下
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141658.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141705.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141711.png>)
- 用户对于已经创建的节点 可以进行信息的查看 或者为他们创建新的父节点或子节点 以及删除该节点的功能
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141718.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141724.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141748.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 143627.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 143634.png>)
- 每个节点可以拥有多个子节点但不能拥有多个父节点
![alt text](<./img/报告图片/屏幕截图 2025-06-28 141814.png>)
- 用户在编辑家谱树中的节点信息时 同样也需要确认编辑 否则只能读信息 不能更改信息
![alt text](<./img/报告图片/屏幕截图 2025-06-28 143825.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 143848.png>)
- 实现代码(部分):
```html
<template>
  <div class="family-tree">
    <el-dialog v-model="showCreateTableDialog" title="新建家谱表" width="400px" :close-on-click-modal="false">
      <el-form :model="createTableForm" :rules="createTableRules" ref="createTableFormRef" label-width="80px">
        <el-form-item label="名称" prop="name">
          <el-input v-model="createTableForm.name" placeholder="请输入家谱表名称" />
        </el-form-item>
        <el-form-item label="内容" prop="content">
          <el-input v-model="createTableForm.content" placeholder="请输入家谱表内容" type="textarea" />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showCreateTableDialog = false">取消</el-button>
        <el-button type="primary" @click="handleCreateTable">确定</el-button>
      </template>
    </el-dialog>
    <!-- 删除家族表选择器相关内容，直接显示家谱树管理界面 -->
    <div class="tree-management">
      <div class="tree-header">
        <div class="header-left">
          <h2>家族树管理</h2>
        </div>
        <div class="header-actions">
          <el-button type="primary" @click="addRootNode">添加根节点</el-button>
          <el-button 
            type="success" 
            @click="addPerson"
            :disabled="!rootNode || hasAddedPerson"
            :title="!rootNode ? '请先添加根节点' : hasAddedPerson ? '已添加过个人，不允许再次添加' : '增加个人'"
          >增加个人</el-button>
          <el-button type="info" @click="refreshTree">刷新数据</el-button>
          <el-button type="warning" @click="viewMemberList">查看成员列表</el-button>
        </div>
      </div>
      <div class="tree-container">
        <div class="tree-wrapper">
          <FamilyNode
            v-if="rootNode"
            :node="rootNode"
            :selectedNode="selectedNode"
            :selectNode="selectNode"
            :addChild="addChild"
            :addParent="addParent"
            :viewNode="viewNode"
            :deleteNode="deleteNode"
            :formatDate="formatDate"
          />
          <div v-else class="empty-tree">
            <el-empty description="暂无家族树数据，请添加根节点开始创建">
              <el-button type="primary" @click="addRootNode">添加根节点</el-button>
            </el-empty>
          </div>
        </div>
      </div>
    </div>

    <!-- 节点编辑对话框 -->
    <el-dialog v-model="dialogVisible" :title="dialogTitle" width="500px">
      <el-form :model="editingNode" :rules="nodeRules" ref="nodeForm" label-width="80px">
        <el-form-item label="姓名" prop="name">
          <el-input v-model="editingNode.name" placeholder="请输入姓名" :disabled="isViewMode" />
        </el-form-item>
        <el-form-item v-if="dialogTitle === '增加个人'" label="父节点" prop="parentId">
          <el-select v-model="editingNode.parentId" placeholder="请选择父节点" style="width: 100%;" @change="onParentChange" :disabled="isViewMode">
            <el-option 
              v-for="node in getAllNodes()" 
              :key="node.id" 
              :label="node.name" 
              :value="node.id" 
            />
          </el-select>
        </el-form-item>
        <el-form-item v-if="dialogTitle === '增加个人'" label="使用保存信息">
          <el-button 
            type="info" 
            size="small" 
            @click="loadSavedInfo"
            :disabled="!hasSavedInfo() || isViewMode"
          >使用已保存的个人信息</el-button>
        </el-form-item>
        <el-form-item label="出生日期" prop="birthDate">
          <el-date-picker 
            v-model="editingNode.birthDate" 
            type="date" 
            placeholder="选择出生日期" 
            format="YYYY-MM-DD"
            value-format="YYYY-MM-DD"
            style="width: 100%;" 
            :disabled="isViewMode"
          />
        </el-form-item>
        <el-form-item label="死亡日期">
          <el-date-picker 
            v-model="editingNode.deathDate" 
            type="date" 
            placeholder="选择死亡日期" 
            format="YYYY-MM-DD"
            value-format="YYYY-MM-DD"
            style="width: 100%;" 
            :disabled="isViewMode"
          />
        </el-form-item>
        <el-form-item label="性别" prop="gender">
          <el-select v-model="editingNode.gender" placeholder="请选择性别" style="width: 100%;" :disabled="isViewMode">
            <el-option label="男" value="男" />
            <el-option label="女" value="女" />
          </el-select>
        </el-form-item>
        <el-form-item label="关系" prop="relationship">
          <el-select v-model="editingNode.relationship" placeholder="请选择关系" style="width: 100%;" :disabled="isViewMode">
            <el-option label="父亲" value="父亲" />
            <el-option label="母亲" value="母亲" />
            <el-option label="儿子" value="儿子" />
            <el-option label="女儿" value="女儿" />
          </el-select>
        </el-form-item>
        <el-form-item label="生平简介">
          <el-input v-model="editingNode.bio" type="textarea" :rows="3" placeholder="请输入生平简介" :disabled="isViewMode" />
        </el-form-item>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="dialogVisible = false">取消</el-button>
          <el-button v-if="isViewMode" type="primary" @click="enableEdit">编辑</el-button>
          <el-button v-else type="primary" @click="saveNode">确定</el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>
```
### 6.4 列表展示成员信息并添加事件描述功能
- 管理系统的最后一个功能是查看一个家谱表中所有成员的信息并添加事件
- 左上角可以进行选择家谱表 可以查看不同家谱表的成员
![alt text](<./img/报告图片/屏幕截图 2025-06-28 144017.png>)
- 点击查看事件按钮 可以进行该成员的事件编辑功能 进行事件的添加、编辑和删除功能 信息包括事件时间、类型和描述
![alt text](<./img/报告图片/屏幕截图 2025-06-28 144419.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 144524.png>)
![alt text](<./img/报告图片/屏幕截图 2025-06-28 144529.png>)
- 代码实现
```html
<template>
  <div class="member-list">
    <div style="margin-bottom: 16px;">
      <el-select v-model="selectedFamilyTableId" placeholder="请选择家谱表" @change="onTableChange" style="width: 220px;">
        <el-option
          v-for="table in familyTables"
          :key="table.id"
          :label="table.name || table.tableName || table.table_name"
          :value="table.id"
        />
      </el-select>
    </div>
    <!-- 删除家族表选择器相关内容，直接显示成员列表界面 -->
    <div class="member-list-content">
      <div class="header">
        <h2>家族成员列表</h2>
        <div class="header-actions">
          <el-button type="primary" @click="refreshData" :loading="loading">
            <el-icon><Refresh /></el-icon>
            刷新
          </el-button>
        </div>
      </div>
      <div class="content">
        <div v-if="loading" class="loading">
          <el-skeleton :rows="10" animated />
        </div>
        
        <div v-else-if="members.length === 0" class="empty-state">
          <el-empty description="暂无成员信息" />
        </div>
        
        <div v-else class="member-table">
          <el-table 
            :data="members" 
            stripe 
            border 
            style="width: 100%"
            :header-cell-style="{ background: '#f5f7fa', color: '#606266' }"
          >
            <el-table-column prop="id" label="ID" width="80" align="center" />
            
            <el-table-column prop="name" label="姓名" width="120" align="center">
              <template #default="scope">
                <span class="member-name">{{ scope.row.name }}</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="gender" label="性别" width="80" align="center">
              <template #default="scope">
                <el-tag :type="scope.row.gender === '男' ? 'primary' : 'danger'" size="small">
                  {{ scope.row.gender }}
                </el-tag>
              </template>
            </el-table-column>
            
            <el-table-column prop="birthDate" label="出生日期" width="120" align="center">
              <template #default="scope">
                <span v-if="scope.row.birthDate">{{ formatDate(scope.row.birthDate) }}</span>
                <span v-else class="text-muted">-</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="deathDate" label="死亡日期" width="120" align="center">
              <template #default="scope">
                <span v-if="scope.row.deathDate">{{ formatDate(scope.row.deathDate) }}</span>
                <span v-else class="text-muted">-</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="parentName" label="父节点" width="120" align="center">
              <template #default="scope">
                <span v-if="scope.row.parentName">{{ scope.row.parentName }}</span>
                <span v-else class="text-muted">根节点</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="relationship" label="关系" width="100" align="center">
              <template #default="scope">
                <el-tag v-if="scope.row.relationship" type="success" size="small">
                  {{ scope.row.relationship }}
                </el-tag>
                <span v-else class="text-muted">-</span>
              </template>
            </el-table-column>
            
            <el-table-column label="年龄" width="100" align="center">
              <template #default="scope">
                <span v-if="scope.row.birthDate">{{ calculateAge(scope.row.birthDate, scope.row.deathDate) }}</span>
                <span v-else class="text-muted">-</span>
              </template>
            </el-table-column>
            
            <el-table-column label="状态" width="100" align="center">
              <template #default="scope">
                <el-tag 
                  :type="scope.row.deathDate ? 'danger' : 'success'" 
                  size="small"
                >
                  {{ scope.row.deathDate ? '已故' : '在世' }}
                </el-tag>
              </template>
            </el-table-column>
            
            <el-table-column label="操作" width="150" align="center" fixed="right">
              <template #default="scope">
                <el-button 
                  type="primary" 
                  size="small" 
                  @click="viewMemberEvents(scope.row)"
                >
                  查看事件
                </el-button>
              </template>
            </el-table-column>
          </el-table>
          
          <div class="table-footer">
            <div class="summary">
              共 {{ members.length }} 位成员
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 成员详情对话框 -->
    <el-dialog 
      v-model="detailDialogVisible" 
      title="成员详情" 
      width="500px"
      :close-on-click-modal="false"
    >
      <div v-if="selectedMember" class="member-detail">
        <div class="detail-item">
          <label>姓名：</label>
          <span>{{ selectedMember.name }}</span>
        </div>
        <div class="detail-item">
          <label>性别：</label>
          <el-tag :type="selectedMember.gender === '男' ? 'primary' : 'danger'" size="small">
            {{ selectedMember.gender }}
          </el-tag>
        </div>
        <div class="detail-item">
          <label>出生日期：</label>
          <span>{{ selectedMember.birthDate ? formatDate(selectedMember.birthDate) : '-' }}</span>
        </div>
        <div class="detail-item">
          <label>死亡日期：</label>
          <span>{{ selectedMember.deathDate ? formatDate(selectedMember.deathDate) : '-' }}</span>
        </div>
        <div class="detail-item">
          <label>父节点：</label>
          <span>{{ selectedMember.parentName || '根节点' }}</span>
        </div>
        <div class="detail-item">
          <label>关系：</label>
          <el-tag v-if="selectedMember.relationship" type="success" size="small">
            {{ selectedMember.relationship }}
          </el-tag>
          <span v-else>-</span>
        </div>
        <div class="detail-item">
          <label>年龄：</label>
          <span>{{ selectedMember.birthDate ? calculateAge(selectedMember.birthDate, selectedMember.deathDate) : '-' }}</span>
        </div>
        <div class="detail-item">
          <label>状态：</label>
          <el-tag 
            :type="selectedMember.deathDate ? 'danger' : 'success'" 
            size="small"
          >
            {{ selectedMember.deathDate ? '已故' : '在世' }}
          </el-tag>
        </div>
      </div>
      
      <template #footer>
        <el-button @click="detailDialogVisible = false">关闭</el-button>
      </template>
    </el-dialog>

    <!-- 成员事件管理对话框 -->
    <el-dialog 
      v-model="eventDialogVisible" 
      :title="`${selectedMemberName} 的重要事件`" 
      width="800px"
      :close-on-click-modal="false"
    >
      <div class="event-header">
        <el-button type="primary" @click="showAddEventDialog = true">添加事件</el-button>
      </div>
      
      <div class="event-list">
        <div v-if="events.length === 0" class="empty-events">
          <el-empty description="暂无事件记录" />
        </div>
        <el-table v-else :data="events" style="width: 100%; margin-top: 16px;">
          <el-table-column prop="event_date" label="事件日期" width="120" align="center">
            <template #default="scope">
              <span>{{ formatDate(scope.row.event_date) }}</span>
            </template>
          </el-table-column>
          <el-table-column prop="event_type" label="事件类型" width="120" align="center" />
          <el-table-column prop="event_description" label="事件描述" />
          <el-table-column label="操作" width="120" align="center">
            <template #default="scope">
              <el-button type="primary" size="small" @click="editEvent(scope.row)">编辑</el-button>
              <el-button type="danger" size="small" @click="deleteEvent(scope.row)">删除</el-button>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </el-dialog>

    <!-- 添加/编辑事件对话框 -->
    <el-dialog 
      v-model="showAddEventDialog" 
      :title="isEditEvent ? '编辑事件' : '添加事件'" 
      width="500px"
    >
      <el-form :model="eventForm" :rules="eventRules" ref="eventFormRef" label-width="80px">
        <el-form-item label="事件日期" prop="event_date">
          <el-date-picker 
            v-model="eventForm.event_date" 
            type="date" 
            placeholder="选择事件日期" 
            format="YYYY-MM-DD"
            value-format="YYYY-MM-DD"
            style="width: 100%;" 
          />
        </el-form-item>
        <el-form-item label="事件类型" prop="event_type">
          <el-select v-model="eventForm.event_type" placeholder="请选择事件类型" style="width: 100%;">
            <el-option label="生活" value="生活" />
            <el-option label="事业学业" value="事业学业" />
            <el-option label="婚姻家庭" value="婚姻家庭" />
            <el-option label="荣誉" value="荣誉" />
            <el-option label="家族" value="家族" />
            <el-option label="其他" value="其他" />
          </el-select>
        </el-form-item>
        <el-form-item label="事件描述" prop="event_description">
          <el-input 
            v-model="eventForm.event_description" 
            type="textarea" 
            :rows="3" 
            placeholder="请输入事件描述" 
          />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showAddEventDialog = false">取消</el-button>
        <el-button type="primary" @click="handleSaveEvent">确定</el-button>
      </template>
    </el-dialog>
  </div>
</template>
```
## 七、 项目总结<a id="7"></a>
- 这次课程设计对我来说意义重大 因为这次相对于以前的课程设计 综合性很强 我们不仅需要学习新的前端技术，我们从前一无所知的vue语言js语言 同时还要学习前后端的概念、运作方式以及如何和数据库相互连接互动。这对于我是一个很大的挑战。前期的部署经常出现问题，一些大大小小的问题经常困扰我很久 有时候甚至浪费了一个下午的时间。项目也是重新创建删除了很多次，直到后来看了很多的教程、得到别人的帮助进度才加快了许多。总的来说，我从这次课程中学到了许多，重新了解了Java语言、编写数据库表格、了解了前端界面的显示方式和控制方式，也学会了依靠强大的网络资源来帮助自己。因此我受益匪浅，我非常感谢这次课程设计，它让我成长了许多。